<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>4 x 40 B-Day-Bash - Partybeiträge</title>
<meta content="Partybeiträge für die 4 x 40 B-Day-Bash Party am 01.-03.08.2025 im Anglerheim Jena" name="description"/>
<meta content="Birthday Party, Partybeiträge, Geburtstag, Party, Jena" name="keywords"/>

<!-- Firebase SDK für Realtime Database -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
<style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    // Admin-Bereich Logik
    function adminLogin() {
        const passwordInput = document.getElementById('adminPassword');
        if (passwordInput.value === ADMIN_PASSWORD) {
            document.getElementById('adminLogin').style.display = 'none';
            document.getElementById('adminControls').style.display = 'block';
            checkAdminStatus();
        } else {
            alert('Falsches Passwort!');
        }
        passwordInput.value = '';
    }

    function adminLogout() {
        document.getElementById('adminLogin').style.display = 'block';
        document.getElementById('adminControls').style.display = 'none';
        googleDriveConnected = false;
        updateDriveStatus();
    }

    function checkAdminStatus() {
        const adminPasswordElement = document.getElementById('adminPassword');
        if (document.getElementById('adminControls').style.display === 'block' || adminPasswordElement.value === ADMIN_PASSWORD) {
            document.getElementById('adminLogin').style.display = 'none';
            document.getElementById('adminControls').style.display = 'block';
            document.getElementById('exportSection').style.display = 'block';
            if (CLIENT_ID !== 'YOUR_CLIENT_ID' && API_KEY !== 'YOUR_API_KEY') {
                updateDriveStatus();
                document.getElementById('driveStatus').style.display = 'block';
            } else {
                document.getElementById('driveStatus').style.display = 'none';
            }
        } else {
            document.getElementById('adminLogin').style.display = 'block';
            document.getElementById('adminControls').style.display = 'none';
            document.getElementById('driveStatus').style.display = 'none';
            document.getElementById('exportSection').style.display = 'none';
        }
    }

    // Google Drive Integration
    function gapiLoaded() {
        gapi.load('client', initializeGapiClient);
    }

    function initializeGapiClient() {
        gapi.client.init({
            apiKey: API_KEY,
            discoveryDocs: DISCOVERY_DOCS,
        }).then(() => {
            gapiInited = true;
            maybeEnableButtons();
        });
    }

    function gisLoaded() {
        tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: CLIENT_ID,
            scope: SCOPES,
            callback: (tokenResponse) => {
                if (tokenResponse && tokenResponse.access_token) {
                    googleDriveConnected = true;
                    updateDriveStatus();
                    loadFromGoogleDrive();
                }
            },
        });
        gisInited = true;
        maybeEnableButtons();
    }

    function maybeEnableButtons() {
        if (gapiInited && gisInited) {
            // Buttons können hier aktiviert werden falls nötig
        }
    }

    function connectToGoogleDrive() {
        if (!googleDriveConnected) {
            tokenClient.callback = (resp) => {
                if (resp.error) {
                    throw (resp);
                }
                googleDriveConnected = true;
                updateDriveStatus();
                loadFromGoogleDrive();
            };

            if (gapi.client.getToken() === null) {
                tokenClient.requestAccessToken({prompt: 'consent'});
            } else {
                tokenClient.requestAccessToken({prompt: ''});
            }
        }
    }

    function updateDriveStatus() {
        const driveStatusDiv = document.getElementById('driveStatus');
        const statusTextSpan = document.getElementById('statusText');
        const connectBtn = document.getElementById('connectBtn');

        if (googleDriveConnected) {
            driveStatusDiv.classList.remove('disconnected');
            driveStatusDiv.classList.add('connected');
            statusTextSpan.textContent = 'Verbunden';
            connectBtn.style.display = 'none';
        } else {
            driveStatusDiv.classList.remove('connected');
            driveStatusDiv.classList.add('disconnected');
            statusTextSpan.textContent = 'Nicht verbunden';
            connectBtn.style.display = 'block';
        }
    }

    // Google Drive file handling
    const FILE_NAME = 'party_data.json';
    const EXCEL_FILE_NAME = 'party_beitraege.xlsx';
    let fileId = null;

    async function loadFromGoogleDrive() {
        try {
            const response = await gapi.client.drive.files.list({
                spaces: 'appDataFolder',
                q: `name = '${FILE_NAME}'`
            });
            const files = response.result.files;
            if (files.length > 0) {
                fileId = files[0].id;
                const fileContentResponse = await gapi.client.drive.files.get({
                    fileId: fileId,
                    alt: 'media'
                });
                const loadedData = JSON.parse(fileContentResponse.body);
                data.items = data.items.map(defaultItem => {
                    const loadedItem = loadedData.items.find(item => item.id === defaultItem.id);
                    return loadedItem ? { ...defaultItem, ...loadedItem } : defaultItem;
                });
                loadedData.items.forEach(loadedItem => {
                    if (!data.items.some(defaultItem => defaultItem.id === loadedItem.id)) {
                        data.items.push(loadedItem);
                    }
                });
                data.additionalItems = loadedData.additionalItems || [];
                console.log('Data loaded from Google Drive:', data);
                createItemCards();
                createAdditionalItemCards();
            } else {
                console.log('No data file found on Google Drive, creating a new one.');
                saveToGoogleDrive();
            }
        } catch (error) {
            console.error('Error loading from Google Drive:', error);
            alert('Fehler beim Laden der Daten von Google Drive. Überprüfen Sie Ihre Verbindung und Berechtigungen.');
        }
    }

    async function saveToGoogleDrive() {
        const fileMetadata = {
            'name': FILE_NAME,
            'parents': ['appDataFolder']
        };
        const media = {
            mimeType: 'application/json',
            body: JSON.stringify(data)
        };

        try {
            if (fileId) {
                await gapi.client.drive.files.update({
                    fileId: fileId,
                    resource: fileMetadata,
                    media: media,
                    fields: 'id'
                });
                console.log('Data updated on Google Drive.');
            } else {
                const response = await gapi.client.drive.files.create({
                    resource: fileMetadata,
                    media: media,
                    fields: 'id'
                });
                fileId = response.result.id;
                console.log('Data saved to Google Drive, file ID:', fileId);
            }
        } catch (error) {
            console.error('Error saving to Google Drive:', error);
            alert('Fehler beim Speichern der Daten auf Google Drive. Überprüfen Sie Ihre Verbindung und Berechtigungen.');
        }
    }

    // Export Functions
    function exportToCSV() {
        let csvContent = "data:text/csv;charset=utf-8,";
        csvContent += "Kategorie,Beitrag,Name,Anzahl_Eingetragen\n";

        data.items.forEach(item => {
            if (item.persons.length > 0) {
                item.persons.forEach(person => {
                    csvContent += `Benötigt,"${item.name}","${person}",${item.persons.length}\n`;
                });
            } else {
                csvContent += `Benötigt,"${item.name}",,0\n`;
            }
        });

        data.additionalItems.forEach(item => {
            if (item.persons.length > 0) {
                item.persons.forEach(person => {
                    csvContent += `Weitere Beiträge,"${item.name}","${person}",${item.persons.length}\n`;
                });
            } else {
                csvContent += `Weitere Beiträge,"${item.name}",,0\n`;
            }
        });

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "party_beitraege.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showThankYouEffect("CSV Export erfolgreich!");
    }

    function exportToExcel() {
        let csvContent = "data:application/vnd.ms-excel;charset=utf-8,";
        csvContent += "Kategorie\tBeitrag\tName\tAnzahl_Eingetragen\n";

        data.items.forEach(item => {
            if (item.persons.length > 0) {
                item.persons.forEach(person => {
                    csvContent += `Benötigt\t"${item.name}"\t"${person}"\t${item.persons.length}\n`;
                });
            } else {
                csvContent += `Benötigt\t"${item.name}"\t\t0\n`;
            }
        });

        data.additionalItems.forEach(item => {
            if (item.persons.length > 0) {
                item.persons.forEach(person => {
                    csvContent += `Weitere Beiträge\t"${item.name}"\t"${person}"\t${item.persons.length}\n`;
                });
            } else {
                csvContent += `Weitere Beiträge\t"${item.name}"\t\t0\n`;
            }
        });

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "party_beitraege.xls");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showThankYouEffect("Excel Export erfolgreich!");
    }

    // Neue Sync-Funktion für Google Drive
    async function syncWithGoogleDrive() {
        if (!googleDriveConnected) {
            alert('Bitte zuerst mit Google Drive verbinden!');
            return;
        }

        try {
            let excelData = "Kategorie\tBeitrag\tName\tAnzahl_Eingetragen\n";

            data.items.forEach(item => {
                if (item.persons.length > 0) {
                    item.persons.forEach(person => {
                        excelData += `Benötigt\t"${item.name}"\t"${person}"\t${item.persons.length}\n`;
                    });
                } else {
                    excelData += `Benötigt\t"${item.name}"\t\t0\n`;
                }
            });

            data.additionalItems.forEach(item => {
                if (item.persons.length > 0) {
                    item.persons.forEach(person => {
                        excelData += `Weitere Beiträge\t"${item.name}"\t"${person}"\t${item.persons.length}\n`;
                    });
                } else {
                    excelData += `Weitere Beiträge\t"${item.name}"\t\t0\n`;
                }
            });

            const excelListResponse = await gapi.client.drive.files.list({
                q: `name = '${EXCEL_FILE_NAME}'`
            });

            const fileMetadata = {
                'name': EXCEL_FILE_NAME
            };
            const media = {
                mimeType: 'application/vnd.ms-excel',
                body: excelData
            };

            if (excelListResponse.result.files.length > 0) {
                await gapi.client.drive.files.update({
                    fileId: excelListResponse.result.files[0].id,
                    resource: fileMetadata,
                    media: media,
                    fields: 'id'
                });
                showThankYouEffect("Google Drive synchronisiert!");
            } else {
                await gapi.client.drive.files.create({
                    resource: fileMetadata,
                    media: media,
                    fields: 'id'
                });
                showThankYouEffect("Excel auf Google Drive erstellt!");
            }

            await saveToGoogleDrive();

        } catch (error) {
            console.error('Error syncing with Google Drive:', error);
            alert('Fehler bei der Synchronisation mit Google Drive!');
        }
    }

    function showShareLink() {
        if (!googleDriveConnected) {
            alert('Bitte zuerst mit Google Drive verbinden!');
            return;
        }
        
        const currentUrl = window.location.href;
        
        const textArea = document.createElement('textarea');
        textArea.value = currentUrl;
        document.body.appendChild(textArea);
        textArea.select();
        
        try {
            document.execCommand('copy');
            showThankYouEffect("Link in Zwischenablage kopiert!");
        } catch (err) {
            alert(`Link zum Teilen: ${currentUrl}`);
        }
        
        document.body.removeChild(textArea);
    }

    // Sterne erzeugen
    function createStars() {
        const starsContainer = document.querySelector('.stars');
        for (let i = 0; i < 100; i++) {
            const star = document.createElement('div');
            star.classList.add('star');
            star.style.top = `${Math.random() * 100}%`;
            star.style.left = `${Math.random() * 100}%`;
            star.style.animationDelay = `${Math.random() * 2}s`;
            starsContainer.appendChild(star);
        }
    }

    // Neon-Linien erzeugen
    function createNeonLines() {
        const neonLinesContainer = document.querySelector('.neon-lines');
        for (let i = 0; i < 5; i++) {
            const line = document.createElement('div');
            line.classList.add('neon-line');
            line.style.top = `${Math.random() * 100}%`;
            line.style.animationDelay = `${Math.random() * 2}s`;
            line.style.animationDuration = `${3 + Math.random() * 2}s`;
            neonLinesContainer.appendChild(line);
        }
    }
    
    body {
        font-family: 'Orbitron', monospace;
        background: linear-gradient(135deg, #1a0033 0%, #2d1b4e 50%, #4a0e4e 100%);
        min-height: 100vh;
        color: #ffffff;
        overflow-x: hidden;
    }
    
    .stars {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: -1;
    }
    
    .star {
        position: absolute;
        width: 2px;
        height: 2px;
        background: #ffffff;
        border-radius: 50%;
        animation: twinkle 2s infinite alternate;
    }
    
    @keyframes twinkle {
        0% { opacity: 0.3; }
        100% { opacity: 1; }
    }
    
    .neon-lines {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: -1;
    }
    
    .neon-line {
        position: absolute;
        height: 2px;
        background: linear-gradient(90deg, transparent, #ff00ff, transparent);
        animation: neon-sweep 4s linear infinite;
    }
    
    @keyframes neon-sweep {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100vw); }
    }

    /* Neuer dezenter Lasereffekt */
    .laser-background {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: -2;
        overflow: hidden;
    }

    .laser-beam {
        position: absolute;
        width: 1px;
        height: 100vh;
        background: linear-gradient(0deg, 
            transparent 0%, 
            rgba(0, 255, 255, 0.1) 20%, 
            rgba(255, 0, 255, 0.15) 50%, 
            rgba(0, 255, 255, 0.1) 80%, 
            transparent 100%);
        animation: laser-move 8s linear infinite;
        opacity: 0.6;
    }

    .laser-beam:nth-child(2) {
        animation-delay: -2s;
        background: linear-gradient(0deg, 
            transparent 0%, 
            rgba(255, 0, 255, 0.1) 20%, 
            rgba(0, 255, 255, 0.15) 50%, 
            rgba(255, 0, 255, 0.1) 80%, 
            transparent 100%);
    }

    .laser-beam:nth-child(3) {
        animation-delay: -4s;
        animation-duration: 10s;
    }

    .laser-beam:nth-child(4) {
        animation-delay: -6s;
        animation-duration: 12s;
        background: linear-gradient(0deg, 
            transparent 0%, 
            rgba(255, 255, 0, 0.08) 20%, 
            rgba(255, 0, 255, 0.12) 50%, 
            rgba(255, 255, 0, 0.08) 80%, 
            transparent 100%);
    }

    @keyframes laser-move {
        0% { 
            left: -10px; 
            transform: rotate(1deg);
        }
        25% { 
            left: 25%; 
            transform: rotate(-0.5deg);
        }
        50% { 
            left: 50%; 
            transform: rotate(0.8deg);
        }
        75% { 
            left: 75%; 
            transform: rotate(-0.3deg);
        }
        100% { 
            left: calc(100% + 10px); 
            transform: rotate(0.5deg);
        }
    }
    
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        position: relative;
    }
    
    .header {
        text-align: center;
        margin-bottom: 40px;
        padding: 30px;
        background: rgba(0, 0, 0, 0.3);
        border: 2px solid #ff00ff;
        border-radius: 15px;
        box-shadow: 0 0 30px rgba(255, 0, 255, 0.3);
    }
    
    .title {
        font-size: clamp(1.8rem, 6vw, 3rem);
        font-weight: 900;
        color: #ff00ff;
        text-shadow: 0 0 20px #ff00ff;
        margin-bottom: 10px;
        letter-spacing: 3px;
        word-wrap: break-word;
        overflow-wrap: break-word;
        line-height: 1.2;
    }
    
    .date {
        font-size: clamp(1rem, 3vw, 1.5rem);
        color: #00ffff;
        text-shadow: 0 0 10px #00ffff;
        margin-bottom: 20px;
        letter-spacing: 2px;
    }
    
    .subtitle {
        font-size: clamp(0.9rem, 2.5vw, 1.2rem);
        color: #ffffff;
        opacity: 0.8;
    }
    
    .items-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }
    
    .section-title {
        font-size: clamp(1.5rem, 4vw, 2rem);
        font-weight: 900;
        color: #ff00ff;
        text-shadow: 0 0 15px rgba(255, 0, 255, 0.8);
        text-align: center;
        margin: 40px 0 30px;
        letter-spacing: 2px;
    }

    .section-title.highlighted-plus {
        font-size: clamp(1.8rem, 4.5vw, 2.5rem);
        color: #ffff00;
        text-shadow: 0 0 20px #ffff00, 0 0 30px rgba(255, 255, 0, 0.8);
        animation: pulse-plus 1.5s infinite alternate;
    }

    @keyframes pulse-plus {
        0% {
            transform: scale(1);
            opacity: 1;
        }
        100% {
            transform: scale(1.05);
            opacity: 0.9;
        }
    }
    
    .additional-section {
        margin-top: 50px;
    }
    
    .add-item-card {
        background: rgba(0, 0, 0, 0.2);
        border: 2px dashed #666;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        transition: all 0.3s ease;
        position: relative;
        overflow: visible;
    }
    
    .add-item-card:hover {
        border-color: #ff00ff;
        box-shadow: 0 0 20px rgba(255, 0, 255, 0.1);
    }
    
    .add-item-title {
        color: #ffff00;
        font-size: 1.5rem;
        text-shadow: 0 0 15px #ffff00;
        font-size: 1.2rem;
        font-weight: 700;
        color: #ff00ff;
        margin-bottom: 15px;
        text-shadow: 0 0 10px rgba(255, 0, 255, 0.5);
    }
    
    .add-item-controls {
        display: flex;
        gap: 10px;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .add-item-input {
        flex: 1;
        min-width: 200px;
        padding: 10px;
        border: 2px solid #333;
        border-radius: 5px;
        background: rgba(0, 0, 0, 0.7);
        color: #ffffff;
        font-family: 'Orbitron', monospace;
        font-size: 1rem;
    }
    
    .add-item-input:focus {
        outline: none;
        border-color: #ff00ff;
        box-shadow: 0 0 10px rgba(255, 0, 255, 0.3);
    }
    
    .btn-add {
        font-size: 1.1rem;
        font-weight: 900;
        box-shadow: 0 0 20px rgba(255, 0, 255, 0.6);
        background: linear-gradient(45deg, #ff00ff, #00ffff);
        color: #000;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        font-family: 'Orbitron', monospace;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        font-size: 0.9rem;
    }
    
    .btn-add:hover {
        box-shadow: 0 0 15px rgba(255, 0, 255, 0.5);
        transform: translateY(-2px);
    }
    
    .additional-items-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .additional-item-card {
        background: rgba(0, 0, 0, 0.3);
        border: 2px solid #666;
        border-radius: 10px;
        padding: 20px;
        transition: all 0.3s ease;
        position: relative;
        overflow: visible;
    }
    
    .additional-item-card:hover {
        border-color: #00ffff;
        box-shadow: 0 0 20px rgba(0, 255, 255, 0.1);
    }
    
    .additional-item-name {
        font-size: 1.2rem;
        font-weight: 700;
        color: #00ffff;
        margin-bottom: 10px;
        text-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
    }
    
    .additional-note {
        font-size: 0.8rem;
        color: #888;
        font-style: italic;
        margin-bottom: 15px;
    }
    
    .item-card {
        background: rgba(0, 0, 0, 0.4);
        border: 2px solid #333;
        border-radius: 10px;
        padding: 20px;
        transition: all 0.3s ease;
        position: relative;
        overflow: visible;
    }
    
    .item-card:hover {
        border-color: #ff00ff;
        box-shadow: 0 0 20px rgba(255, 0, 255, 0.2);
    }
    
    .item-card.taken {
        border-color: #00ff00;
        box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
    }
    
    .item-name {
        font-size: 1.3rem;
        font-weight: 700;
        color: #ffffff;
        margin-bottom: 10px;
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
    }

    .item-counter {
        font-size: 0.9rem;
        color: #00ffff;
        margin-bottom: 15px;
        text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
    }
    
    .persons-list {
        margin-bottom: 15px;
        max-height: 150px;
        overflow-y: auto;
    }
    
    .person-entry {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        margin-bottom: 5px;
        background: rgba(0, 255, 0, 0.1);
        border: 1px solid rgba(0, 255, 0, 0.3);
        border-radius: 5px;
        transition: all 0.3s ease;
    }
    
    .person-entry:hover {
        background: rgba(0, 255, 0, 0.2);
        border-color: rgba(0, 255, 0, 0.5);
    }
    
    .person-name {
        color: #00ff00;
        font-weight: 600;
        text-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
    }
    
    .btn-small {
        padding: 4px 8px;
        border: none;
        border-radius: 3px;
        font-family: 'Orbitron', monospace;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.8rem;
    }
    
    .btn-small.btn-unregister {
        background: linear-gradient(45deg, #ff4444, #ff6666);
        color: #fff;
    }
    
    .btn-small.btn-unregister:hover {
        background: linear-gradient(45deg, #ff6666, #ff8888);
        transform: scale(1.1);
    }
    
    .complete-message {
        color: #00ff00;
        font-weight: 700;
        font-size: 1.1rem;
        text-align: center;
        text-shadow: 0 0 15px rgba(0, 255, 0, 0.8);
        animation: neon-pulse 2s ease-in-out infinite;
    }
    
    .item-controls {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
    }
    
    .name-input {
        flex: 1;
        padding: 10px;
        border: 2px solid #333;
        border-radius: 5px;
        background: rgba(0, 0, 0, 0.7);
        color: #ffffff;
        font-family: 'Orbitron', monospace;
        font-size: 1rem;
        min-width: 150px;
    }
    
    .name-input:focus {
        outline: none;
        border-color: #ff00ff;
        box-shadow: 0 0 10px rgba(255, 0, 255, 0.3);
    }
    
    .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        font-family: 'Orbitron', monospace;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        font-size: 0.9rem;
    }
    
    .btn-take {
        background: linear-gradient(45deg, #ff00ff, #00ffff);
        color: #000;
    }
    
    .btn-take:hover {
        box-shadow: 0 0 15px rgba(255, 0, 255, 0.5);
        transform: translateY(-2px);
    }
    
    .btn-release {
        background: linear-gradient(45deg, #ff4444, #ff6666);
        color: #fff;
    }
    
    .btn-release:hover {
        box-shadow: 0 0 15px rgba(255, 68, 68, 0.5);
        transform: translateY(-2px);
    }
    
    .btn-unregister {
        background: linear-gradient(45deg, #ffaa00, #ff6600);
        color: #fff;
        margin-left: 10px;
    }
    
    .btn-unregister:hover {
        box-shadow: 0 0 15px rgba(255, 170, 0, 0.5);
        transform: translateY(-2px);
    }
    
    .taken-by {
        color: #00ff00;
        font-weight: 700;
        text-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        flex: 1;
    }
    
    .taken-controls {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
    }
    
    /* Danke-Effekt */
    .thank-you-effect {
        white-space: normal;
        max-width: 90vw;
        word-break: break-word;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: clamp(1.2rem, 3vw, 2rem);
        font-weight: 900;
        color: #00ffff;
        text-shadow: 0 0 20px #00ffff;
        font-family: 'Orbitron', monospace;
        letter-spacing: 3px;
        opacity: 0;
        z-index: 100;
        pointer-events: none;
        animation: thank-you-animation 4s ease-out forwards;
        text-align: center;
        white-space: nowrap;
        padding: 0 20px;
    }
    
    .thank-you-effect::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(45deg, #00ffff, #ff00ff, #00ffff);
        background-size: 200% 200%;
        animation: hologram-shimmer 0.5s ease-in-out infinite;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        z-index: -1;
    }
    
    .thank-you-effect::after {
        content: '';
        position: absolute;
        top: -10px;
        left: -10px;
        right: -10px;
        bottom: -10px;
        background: radial-gradient(circle, rgba(0, 255, 255, 0.3) 0%, transparent 70%);
        border-radius: 50%;
        animation: pulse-glow 4s ease-out;
        z-index: -2;
    }
    
    .goodbye-effect {
        white-space: normal;
        max-width: 90vw;
        word-break: break-word;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: clamp(1rem, 2.5vw, 1.8rem);
        font-weight: 900;
        color: #ffaa00;
        text-shadow: 0 0 20px #ffaa00;
        font-family: 'Orbitron', monospace;
        letter-spacing: 2px;
        opacity: 0;
        z-index: 100;
        pointer-events: none;
        animation: goodbye-animation 4s ease-out forwards;
        text-align: center;
        white-space: nowrap;
        padding: 0 20px;
    }
    
    .goodbye-effect::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(45deg, #ffaa00, #ff6600, #ffaa00);
        background-size: 200% 200%;
        animation: hologram-shimmer 0.5s ease-in-out infinite;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        z-index: -1;
    }
    
    /* Particle-Effekt */
    .particle {
        position: absolute;
        width: 3px;
        height: 3px;
        background: #00ffff;
        border-radius: 50%;
        pointer-events: none;
        animation: particle-float 4s ease-out forwards;
    }
    
    .particle:nth-child(odd) {
        background: #ff00ff;
        animation-delay: 0.1s;
    }
    
    .particle:nth-child(3n) {
        background: #ffffff;
        animation-delay: 0.2s;
    }
    
    .particle-orange {
        background: #ffaa00;
    }
    
    .particle-orange:nth-child(odd) {
        background: #ff6600;
    }
    
    /* Matrix-Effekt */
    .matrix-effect {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: visible;
        pointer-events: none;
        z-index: 99;
    }
    
    .matrix-line {
        position: absolute;
        width: 2px;
        height: 20px;
        background: linear-gradient(to bottom, transparent, #00ffff, transparent);
        animation: matrix-fall 4s linear forwards;
    }
    
    .matrix-line-orange {
        background: linear-gradient(to bottom, transparent, #ffaa00, transparent);
    }
    
    /* Scanline-Effekt */
    .scanline {
        position: absolute;
        width: 100%;
        height: 2px;
        background: linear-gradient(90deg, transparent, #00ffff, transparent);
        top: 50%;
        left: 0;
        animation: scanline-sweep 3s ease-out;
        z-index: 98;
    }
    
    .scanline-orange {
        background: linear-gradient(90deg, transparent, #ffaa00, transparent);
    }
    
    @keyframes thank-you-animation {
        0% {
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.1);
            filter: blur(10px);
        }
        15% {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1.2);
            filter: blur(2px);
        }
        30% {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            filter: blur(0px);
        }
        70% {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            filter: blur(0px);
        }
        100% {
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.8);
            filter: blur(5px);
        }
    }
    
    @keyframes goodbye-animation {
        0% {
            opacity: 0;
            transform: translate(-50%, -50%) scale(1.2);
            filter: blur(5px);
        }
        20% {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            filter: blur(0px);
        }
        60% {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            filter: blur(0px);
        }
        100% {
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.5);
            filter: blur(8px);
        }
    }
    
    @keyframes hologram-shimmer {
        0% {
            background-position: 0% 50%;
        }
        50% {
            background-position: 100% 50%;
        }
        100% {
            background-position: 0% 50%;
        }
    }
    
    @keyframes pulse-glow {
        0% {
            opacity: 0;
            transform: scale(0.5);
        }
        50% {
            opacity: 0.8;
            transform: scale(1.2);
        }
        100% {
            opacity: 0;
            transform: scale(2);
        }
    }
    
    @keyframes particle-float {
        0% {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        100% {
            opacity: 0;
            transform: translateY(-50px) scale(0.5);
        }
    }
    
    @keyframes matrix-fall {
        0% {
            top: -20px;
            opacity: 0;
        }
        50% {
            opacity: 1;
        }
        100% {
            top: 100%;
            opacity: 0;
        }
    }
    
    @keyframes scanline-sweep {
        0% {
            transform: translateY(-100px);
            opacity: 0;
        }
        50% {
            opacity: 1;
        }
        100% {
            transform: translateY(100px);
            opacity: 0;
        }
    }
    
    /* Thank You Animation Overlay */
    .thank-you-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
    }
    
    .thank-you-overlay.show {
        opacity: 1;
        pointer-events: all;
    }
    
    .thank-you-content {
        text-align: center;
        position: relative;
    }
    
    .thank-you-text {
        font-size: 4rem;
        font-weight: 900;
        color: #ff00ff;
        text-shadow: 0 0 30px #ff00ff;
        margin-bottom: 20px;
        animation: glitch 0.5s ease-in-out infinite alternate;
        
        /* Responsive adjustments for thank you text */
        font-size: clamp(2rem, 8vw, 4rem); /* Smaller on small screens, larger on big */
        padding: 0 10px; /* Add some padding to prevent cutting off at edges */
        white-space: normal; /* Allow text to wrap */
        word-break: break-word; /* Break long words */
    }
    
    .thank-you-subtext {
        font-size: 1.5rem;
        color: #00ffff;
        text-shadow: 0 0 20px #00ffff;
        animation: neon-pulse 1s ease-in-out infinite;

        /* Responsive adjustments for subtext */
        font-size: clamp(1rem, 4vw, 1.5rem);
        padding: 0 10px;
        white-space: normal;
        word-break: break-word;
    }
    
    .retro-grid {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 800px;
        height: 600px;
        background: linear-gradient(
            90deg,
            transparent 49%,
            #ff00ff 50%,
            #ff00ff 51%,
            transparent 52%
        ),
        linear-gradient(
            0deg,
            transparent 49%,
            #ff00ff 50%,
            #ff00ff 51%,
            transparent 52%
        );
        background-size: 40px 40px;
        opacity: 0.3;
        animation: grid-move 2s linear infinite;
        z-index: -1;
    }
    
    .laser-lines {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: visible;
        z-index: -1;
    }
    
    .laser-line {
        position: absolute;
        height: 2px;
        background: linear-gradient(90deg, transparent, #00ffff, transparent);
        animation: laser-sweep 1s linear infinite;
        box-shadow: 0 0 10px #00ffff;
    }
    
    @keyframes glitch {
        0% {
            transform: translateX(0);
            text-shadow: 0 0 30px #ff00ff;
        }
        25% {
            transform: translateX(-5px);
            text-shadow: -5px 0 30px #ff00ff, 5px 0 30px #00ffff;
        }
        50% {
            transform: translateX(5px);
            text-shadow: 5px 0 30px #ff00ff, -5px 0 30px #00ffff;
        }
        75% {
            transform: translateX(-2px);
            text-shadow: -2px 0 30px #ff00ff, 2px 0 30px #00ffff;
        }
        100% {
            transform: translateX(0);
            text-shadow: 0 0 30px #ff00ff;
        }
    }
    
    @keyframes neon-pulse {
        0%, 100% {
            text-shadow: 0 0 20px #00ffff;
        }
        50% {
            text-shadow: 0 0 40px #00ffff, 0 0 60px #00ffff;
        }
    }
    
    @keyframes grid-move {
        0% {
            transform: translate(-50%, -50%);
        }
        100% {
            transform: translate(-50%, -70%);
        }
    }
    
    @keyframes laser-sweep {
        0% {
            left: -100%;
            top: 20%;
        }
        100% {
            left: 100%;
            top: 80%;
        }
    }
    
    /* Drive Status */
    .drive-status {
        text-align: center;
        margin-bottom: 20px;
        padding: 15px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        border: 2px solid #333;
        display: none;
        position: relative;
        z-index: 2;
    }
    
    .drive-status.connected {
        border-color: #00ff00;
        box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
    }
    
    .drive-status.disconnected {
        border-color: #ff4444;
        box-shadow: 0 0 20px rgba(255, 68, 68, 0.2);
    }
    
    .status-text {
        font-weight: 700;
        margin-bottom: 10px;
    }
    
    .connect-btn {
        background: linear-gradient(45deg, #00ff00, #00ffff);
        color: #000;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        font-family: 'Orbitron', monospace;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
    }
    
    .connect-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
    }
    
    /* Export Section */
    .export-section {
        text-align: center;
        margin-bottom: 30px;
        display: none;
        position: relative;
        z-index: 2;
    }
    
    .export-btn {
        background: linear-gradient(45deg, #00ffff, #ff00ff);
        color: #000;
        padding: 15px 30px;
        border: none;
        border-radius: 10px;
        font-family: 'Orbitron', monospace;
        font-weight: 700;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        margin: 0 10px;
        box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
    }
    
    .export-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
    }
    
    .export-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    /* Admin Login Section */
    .admin-section {
        text-align: center;
        margin-top: 40px;
        padding: 20px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 15px;
        border: 2px solid #333;
        position: relative;
        overflow: visible;
    }
    
    .admin-login {
        display: block;
        position: relative;
        z-index: 2;
    }
    
    .admin-controls {
        display: none;
        position: relative;
        z-index: 2;
    }
    
    .admin-login-bg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(45deg, transparent, rgba(255, 0, 255, 0.1), transparent);
        animation: admin-bg-pulse 3s ease-in-out infinite;
        z-index: 1;
    }
    
    .admin-title {
        color: #ff00ff;
        font-size: clamp(1.3rem, 3vw, 1.8rem);
        font-weight: 900;
        margin-bottom: 30px;
        text-shadow: 0 0 20px rgba(255, 0, 255, 0.8);
        animation: admin-title-glow 2s ease-in-out infinite alternate;
        letter-spacing: 2px;
    }
    
    .admin-input-container {
        position: relative;
        display: inline-block;
        margin-bottom: 20px;
    }
    
    .admin-input {
        padding: 15px 20px;
        border: 2px solid #333;
        border-radius: 10px;
        background: rgba(0, 0, 0, 0.8);
        color: #ffffff;
        font-family: 'Orbitron', monospace;
        font-size: 1.1rem;
        width: 300px;
        text-align: center;
        transition: all 0.3s ease;
        position: relative;
        z-index: 2;
    }
    
    .admin-input::placeholder {
        color: rgba(255, 255, 255, 0.5);
        font-style: italic;
    }
    
    .admin-input:focus {
        outline: none;
        border-color: #ff00ff;
        box-shadow: 0 0 25px rgba(255, 0, 255, 0.5);
        background: rgba(0, 0, 0, 0.9);
        transform: scale(1.05);
    }
    
    .admin-input-glow {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: 2px solid transparent;
        border-radius: 10px;
        background: linear-gradient(45deg, #ff00ff, #00ffff, #ff00ff);
        background-size: 200% 200%;
        animation: admin-input-border 3s ease-in-out infinite;
        z-index: 1;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .admin-input:focus + .admin-input-glow {
        opacity: 1;
    }
    
    .admin-btn {
        background: linear-gradient(45deg, #ff00ff, #00ffff);
        color: #000;
        padding: 15px 35px;
        border: none;
        border-radius: 10px;
        font-family: 'Orbitron', monospace;
        font-weight: 900;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        font-size: 1.1rem;
        letter-spacing: 1px;
        box-shadow: 0 0 20px rgba(255, 0, 255, 0.3);
    }
    
    .admin-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 0 35px rgba(255, 0, 255, 0.7);
        background: linear-gradient(45deg, #00ffff, #ff00ff);
    }
    
    .admin-panel {
        margin-top: 20px;
        padding: 25px;
        background: rgba(0, 0, 0, 0.4);
        border-radius: 15px;
        border: 2px solid #00ff00;
        box-shadow: 0 0 30px rgba(0, 255, 0, 0.3);
        position: relative;
        overflow: visible;
    }
    
    .admin-panel::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(45deg, transparent, rgba(0, 255, 0, 0.05), transparent);
        animation: admin-panel-pulse 4s ease-in-out infinite;
    }
    
    .admin-panel h3 {
        color: #00ff00;
        margin-bottom: 20px;
        text-shadow: 0 0 15px rgba(0, 255, 0, 0.8);
        font-size: 1.5rem;
        font-weight: 900;
        letter-spacing: 1px;
        position: relative;
        z-index: 2;
    }
    
    .logout-btn {
        background: linear-gradient(45deg, #ff4444, #ff6666);
        color: #fff;
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        font-family: 'Orbitron', monospace;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        float: right;
        box-shadow: 0 0 15px rgba(255, 68, 68, 0.3);
        position: relative;
        z-index: 2;
    }
    
    .logout-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 0 25px rgba(255, 68, 68, 0.6);
    }
    
    .footer {
        text-align: center;
        margin-top: 40px;
        padding: 20px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        border: 2px solid #333;
    }
    
    .footer h3 {
        color: #ff00ff;
        margin-bottom: 10px;
        text-shadow: 0 0 10px rgba(255, 0, 255, 0.5);
    }
    @keyframes admin-bg-pulse {
        0%, 100% {
            opacity: 0.3;
        }
        50% {
            opacity: 0.7;
        }
    }
    @keyframes admin-title-glow {
        0% {
            text-shadow: 0 0 20px rgba(255, 0, 255, 0.8);
        }
        100% {
            text-shadow: 0 0 30px rgba(255, 0, 255, 1), 0 0 40px rgba(0, 255, 255, 0.5);
        }
    }
    @keyframes admin-input-border {
        0% {
            background-position: 0% 50%;
        }
        50% {
            background-position: 100% 50%;
        }
        100% {
            background-position: 0% 50%;
        }
    }
    @keyframes admin-panel-pulse {
        0%, 100% {
            opacity: 0.1;
        }
        50% {
            opacity: 0.3;
        }
    }
    @media (max-width: 768px) {
        .title {
            font-size: clamp(2rem, 6vw, 2.5rem); /* Vergrößert für Mobile */
            letter-spacing: 1px;
        }
        .header {
            padding: 35px; /* Etwas mehr Padding für Mobile */
        }
        .date {
            font-size: clamp(1.1rem, 3.5vw, 1.6rem); /* Auch etwas größer */
        }
        .subtitle {
            font-size: clamp(1rem, 2.8vw, 1.3rem); /* Auch etwas größer */
        }
        .section-title {
            font-size: clamp(1.2rem, 3.5vw, 1.5rem);
            margin: 30px 0 20px;
        }
        .items-grid {
            grid-template-columns: 1fr;
        }
        .additional-items-grid {
            grid-template-columns: 1fr;
        }
        .item-controls {
            flex-direction: column;
            gap: 10px;
        }
        .add-item-controls {
            flex-direction: column;
            gap: 10px;
        }
        .add-item-input {
            min-width: unset;
            width: 100%;
        }
        .taken-controls {
            flex-direction: column;
            gap: 10px;
            align-items: stretch;
        }
        .name-input {
            width: 100%;
        }
        .person-entry {
            padding: 6px 10px;
        }
        .persons-list {
            max-height: 120px;
        }
        .thank-you-text {
            font-size: clamp(2rem, 8vw, 4rem);
        }
        .export-btn {
            display: block;
            margin: 10px auto;
            width: 80%;
        }
        .admin-input {
            width: 100%;
            margin-bottom: 20px;
            max-width: 300px;
        }
        .admin-input-container {
            width: 100%;
            max-width: 300px;
            margin: 0 auto 20px;
        }
        .admin-btn {
            width: 100%;
            max-width: 300px;
        }
        .admin-title {
            font-size: clamp(1.2rem, 2.5vw, 1.5rem);
        }
        .thank-you-effect {
            white-space: normal;
            max-width: 90vw;
            word-break: break-word;
            font-size: clamp(1rem, 2.5vw, 1.5rem);
            letter-spacing: 1px;
        }
        .goodbye-effect {
            white-space: normal;
            max-width: 90vw;
            word-break: break-word;
            font-size: clamp(0.9rem, 2vw, 1.3rem);
            letter-spacing: 1px;
        }
        .particle {
            width: 2px;
            height: 2px;
        }
        .matrix-line {
            width: 1px;
            height: 15px;
        }
    }
    @media (max-width: 480px) {
        .title {
            font-size: clamp(1.8rem, 5.5vw, 2rem); /* Noch größer für sehr kleine Bildschirme */
            letter-spacing: 0px;
        }
        .date {
            font-size: clamp(1rem, 3vw, 1.3rem);
        }
        .subtitle {
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
        }
        .section-title {
            font-size: clamp(1rem, 3vw, 1.2rem);
            margin: 25px 0 15px;
        }
        .container {
            padding: 15px;
        }
        .header {
            padding: 25px; /* Mehr Padding für kleinste Geräte */
        }
        .admin-section {
            padding: 15px;
        }
        .admin-panel {
            padding: 15px;
        }
        .admin-title {
            font-size: clamp(1rem, 2vw, 1.3rem);
            margin-bottom: 25px;
        }
        .admin-input {
            width: 100%;
            max-width: 280px;
            font-size: 1rem;
            padding: 12px 15px;
        }
        .admin-btn {
            width: 100%;
            max-width: 280px;
            padding: 12px 25px;
            font-size: 1rem;
        }
        .logout-btn {
            float: none;
            display: block;
            margin: 0 auto 15px;
            width: 100%;
            max-width: 200px;
        }
        .person-entry {
            padding: 5px 8px;
            font-size: 0.9rem;
        }
        .persons-list {
            max-height: 100px;
        }
        .add-item-card {
            padding: 15px;
        }
        .additional-item-card {
            padding: 15px;
        }
        .thank-you-effect {
            white-space: normal;
            max-width: 90vw;
            word-break: break-word;
            font-size: clamp(0.8rem, 2vw, 1.2rem);
            letter-spacing: 0px;
        }
        .goodbye-effect {
            white-space: normal;
            max-width: 90vw;
            word-break: break-word;
            font-size: clamp(0.7rem, 1.5vw, 1rem);
            letter-spacing: 0px;
        }
        .particle {
            width: 1.5px;
            height: 1.5px;
        }
        .matrix-line {
            width: 1px;
            height: 12px;
        }
        .progress-bar,
        .progress-text {
            display: none !important;
        }
    }
</style>
</head>
<body>
<div class="stars"></div>
<div class="neon-lines"></div>
<div class="laser-background">
    <div class="laser-beam"></div>
    <div class="laser-beam"></div>
    <div class="laser-beam"></div>
    <div class="laser-beam"></div>
</div>

<div class="container">
    <div class="header">
        <h1 class="title">4 x 40 B-DAY-BASH</h1>
        <div class="date">01. - 03. 08. 2025</div>
        <div class="subtitle">Partybeiträge • Anglerheim Jena</div>
        <div class="firebase-status" style="margin-top: 15px; font-size: 0.9rem; opacity: 0.8;"></div>
    </div>

    <div class="section-title">🎯 Benötigte Partybeiträge</div>
    <div class="items-grid" id="itemsGrid">
        </div>

    <div class="additional-section">
        <div class="section-title highlighted-plus">➕ Weitere Partybeiträge</div>
        <div class="additional-items-grid" id="additionalItemsGrid">
            </div>
        <div class="add-item-card">
            <div class="add-item-title">Neuen Partybeitrag vorschlagen</div>
            <div class="additional-note">Hier kannst du weitere Dinge eintragen, die du zur Party beitragen möchtest</div>
            <div class="add-item-controls">
                <input class="add-item-input" id="newItemInput" placeholder="z.B. Chips, Getränke, Deko..." type="text"/>
                <button class="btn btn-add" onclick="addNewItem()">Hinzufügen</button>
            </div>
        </div>
    </div>

    <div class="thank-you-overlay" id="thankYouOverlay">
        <div class="thank-you-content">
            <div class="retro-grid"></div>
            <div class="laser-lines">
                <div class="laser-line" style="width: 300px; animation-delay: 0s;"></div>
                <div class="laser-line" style="width: 400px; animation-delay: 0.3s;"></div>
                <div class="laser-line" style="width: 250px; animation-delay: 0.6s;"></div>
            </div>
            <div class="thank-you-text">DANKE!</div>
            <div class="thank-you-subtext">Vielen Dank für Ihre Anmeldung!</div>
        </div>
    </div>

    <div class="admin-section">
        <div class="admin-login-bg"></div>
        <div class="admin-login" id="adminLogin">
            <div class="admin-title">🔐 ADMIN ACCESS</div>
            <div class="admin-input-container">
                <input class="admin-input" id="adminPassword" placeholder="Enter Password" type="password"/>
                <div class="admin-input-glow"></div>
            </div>
            <br/>
            <button class="admin-btn" onclick="adminLogin()">
                <span>Initialize</span>
            </button>
        </div>

        <div class="admin-controls" id="adminControls">
            <button class="logout-btn" onclick="adminLogout()">Logout</button>
            <div class="admin-panel">
                <h3>⚙️ SYSTEM CONTROL</h3>
                <div class="drive-status" id="driveStatus">
                    <div class="status-text">Google Drive Status: <span id="statusText">Nicht verbunden</span></div>
                    <button class="connect-btn" id="connectBtn" onclick="connectToGoogleDrive()">Mit Google Drive verbinden</button>
                </div>
                <div class="export-section" id="exportSection">
                    <button class="export-btn" onclick="exportToCSV()">📊 CSV Export</button>
                    <button class="export-btn" onclick="exportToExcel()">📈 Excel Export</button>
                    <button class="export-btn" onclick="syncWithGoogleDrive()">🔄 Drive Sync</button>
                    <button class="export-btn" onclick="showShareLink()">🔗 Share Link</button>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <h3>4 x 40 B-Day-Bash</h3>
        <p>© 2025 All rights reserved.</p>
    </div>
</div>

<script>
    // Google Drive API-Variablen
    const CLIENT_ID = 'YOUR_CLIENT_ID'; // Ersetze dies durch deine Client ID
    const API_KEY = 'YOUR_API_KEY';     // Ersetze dies durch deinen API Key
    const DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"];
    const SCOPES = 'https://www.googleapis.com/auth/drive.appdata https://www.googleapis.com/auth/drive.file';

    let tokenClient;
    let gapiInited = false;
    let gisInited = false;
    let googleDriveConnected = false;

    // Admin-Passwort (Beispiel, sollte in einer echten Anwendung sicherer gehandhabt werden)
    const ADMIN_PASSWORD = "admin";

    // Datenstruktur - Unbegrenzte Personen pro Beitrag
    let data = {
        items: [
            { id: "nudelsalat", name: "Nudelsalat", persons: [] },
            { id: "kartoffelsalat", name: "Kartoffelsalat", persons: [] },
            { id: "kraeuterbutter", name: "Kräuterbutter", persons: [] },
            { id: "nutella-erdnussbutter", name: "Nutella, Erdnussbutter", persons: [] },
            { id: "kuchen", name: "Kuchen", persons: [] },
            { id: "marmelade-honig", name: "Marmelade, Honig", persons: [] },
            { id: "aufschnitt-wurst-kaese", name: "Aufschnitt (Wurst, Käse)", persons: [] },
            { id: "aufstriche-herzhaft", name: "Aufstriche (herzhaft)", persons: [] },
            { id: "stockbrot-teig", name: "Stockbrot-Teig", persons: [] },
            { id: "dessert", name: "Dessert", persons: [] },
            { id: "cole-slaw", name: "Cole Slaw", persons: [] }
        ],
        additionalItems: []
    };

    // Listen von Dankes- und Abschiedsreaktionen
    const thankYouReactions = [
        "🙏 Daaaaaankööö! 🙏",
        "💕 Du bist die/der Geilste! 💕",
        "💣 Hammer-fett-bombe-krass! 💣",
        "🥰 Echt?! Thnx!!! 🥰",
        "🛟 Du bist die Rettung 🛟",
        "❤️ Ich hasse alle: Außer DICH! ❤️",
        "❤️‍🔥 Wir lieben Dich! ❤️‍🔥"
    ];

    const goodbyeReactions = [
        "👋 Schade, bis zum nächsten Mal!",
        "💔 Wir werden dich vermissen!",
        "🫡 Verstanden, abgemeldet.",
        "😥 Komm bald wieder!",
        "💨 Tschüssikowski!",
        "👋 Bleib sauber!",
        "🫡 Bis bald, Cowboy!"
    ];

    function getRandomReaction(reactionList) {
        return reactionList[Math.floor(Math.random() * reactionList.length)];
    }

    // Hilfsfunktionen
    function showThankYouEffect(message) {
        const overlay = document.getElementById('thankYouOverlay');
        const thankYouText = overlay.querySelector('.thank-you-text');
        const thankYouSubtext = overlay.querySelector('.thank-you-subtext');

        thankYouText.textContent = getRandomReaction(thankYouReactions);
        thankYouSubtext.textContent = message || "Vielen Dank für Ihre Anmeldung!";

        overlay.classList.add('show');
        createParticles(100, overlay);
        createMatrixEffect(overlay);
        createScanlineEffect(overlay);

        setTimeout(() => {
            overlay.classList.remove('show');
            overlay.innerHTML = `<div class="thank-you-content">
                                    <div class="retro-grid"></div>
                                    <div class="laser-lines">
                                        <div class="laser-line" style="width: 300px; animation-delay: 0s;"></div>
                                        <div class="laser-line" style="width: 400px; animation-delay: 0.3s;"></div>
                                        <div class="laser-line" style="width: 250px; animation-delay: 0.6s;"></div>
                                    </div>
                                    <div class="thank-you-text">DANKE!</div>
                                    <div class="thank-you-subtext">Vielen Dank für Ihre Anmeldung!</div>
                                </div>`;
        }, 4000);
    }

    function showGoodbyeEffect(message) {
        const overlay = document.getElementById('thankYouOverlay');
        const thankYouText = overlay.querySelector('.thank-you-text');
        const thankYouSubtext = overlay.querySelector('.thank-you-subtext');

        thankYouText.textContent = getRandomReaction(goodbyeReactions);
        thankYouSubtext.textContent = message || "Auf Wiedersehen!";

        overlay.classList.add('show');
        createParticles(100, overlay, 'orange');
        createMatrixEffect(overlay, 'orange');
        createScanlineEffect(overlay, 'orange');

        setTimeout(() => {
            overlay.classList.remove('show');
            overlay.innerHTML = `<div class="thank-you-content">
                                    <div class="retro-grid"></div>
                                    <div class="laser-lines">
                                        <div class="laser-line" style="width: 300px; animation-delay: 0s;"></div>
                                        <div class="laser-line" style="width: 400px; animation-delay: 0.3s;"></div>
                                        <div class="laser-line" style="width: 250px; animation-delay: 0.6s;"></div>
                                    </div>
                                    <div class="thank-you-text">DANKE!</div>
                                    <div class="thank-you-subtext">Vielen Dank für Ihre Anmeldung!</div>
                                </div>`;
        }, 4000);
    }

    function createParticles(count, container, colorClass = '') {
        for (let i = 0; i < count; i++) {
            const particle = document.createElement('div');
            particle.classList.add('particle');
            if (colorClass) particle.classList.add(`particle-${colorClass}`);
            particle.style.left = `${Math.random() * 100}%`;
            particle.style.top = `${Math.random() * 100}%`;
            particle.style.animationDelay = `${Math.random() * 2}s`;
            container.appendChild(particle);
        }
    }

    function createMatrixEffect(container, colorClass = '') {
        const matrixEffect = document.createElement('div');
        matrixEffect.classList.add('matrix-effect');
        container.appendChild(matrixEffect);

        for (let i = 0; i < 30; i++) {
            const line = document.createElement('div');
            line.classList.add('matrix-line');
            if (colorClass) line.classList.add(`matrix-line-${colorClass}`);
            line.style.left = `${Math.random() * 100}%`;
            line.style.animationDuration = `${2 + Math.random() * 3}s`;
            line.style.animationDelay = `${Math.random() * 2}s`;
            matrixEffect.appendChild(line);
        }
    }

    function createScanlineEffect(container, colorClass = '') {
        const scanline = document.createElement('div');
        scanline.classList.add('scanline');
        if (colorClass) scanline.classList.add(`scanline-${colorClass}`);
        scanline.style.animationDuration = `${1 + Math.random() * 2}s`;
        container.appendChild(scanline);
    }

    // Speichern und Laden der Daten
    function saveData() {
        localStorage.setItem('partyData', JSON.stringify(data));
        if (googleDriveConnected) {
            saveToGoogleDrive();
        }
    }

    function loadData() {
        const savedData = localStorage.getItem('partyData');
        if (savedData) {
            const parsedData = JSON.parse(savedData);
            data.items = data.items.map(defaultItem => {
                const loadedItem = parsedData.items.find(item => item.id === defaultItem.id);
                return loadedItem ? { ...defaultItem, ...loadedItem } : defaultItem;
            });
            parsedData.items.forEach(loadedItem => {
                if (!data.items.some(defaultItem => defaultItem.id === loadedItem.id)) {
                    data.items.push(loadedItem);
                }
            });
            data.additionalItems = parsedData.additionalItems || [];
        }
    }

    // Fortschrittsbalken aktualisieren
    function updateProgress() {
        const currentPersonsItems = data.items.reduce((sum, item) => sum + item.persons.length, 0);
        const currentPersonsAdditionalItems = data.additionalItems.reduce((sum, item) => sum + item.persons.length, 0);
        const totalPersons = currentPersonsItems + currentPersonsAdditionalItems;

        // Dynamische Fortschrittsberechnung basierend auf Einträgen
        const totalItems = data.items.length + data.additionalItems.length;
        let progressPercentage = 0;
        if (totalItems > 0) {
            const averagePersonsPerItem = totalPersons / totalItems;
            progressPercentage = Math.min(averagePersonsPerItem * 20, 100); // 5 Personen = 100%
        }
        
        document.getElementById('progressFill').style.width = `${progressPercentage}%`;
        
        let progressText = '';
        if (totalPersons === 1) {
            progressText = `1 Person eingetragen`;
        } else if (totalPersons > 1) {
            progressText = `${totalPersons} Personen eingetragen`;
        } else {
            progressText = `Noch keine Einträge`;
        }
        document.getElementById('progressText').textContent = progressText;
    }

    // Item-Karten erstellen (für "Benötigte Partybeiträge") - MIT DEBUG
    function createItemCards() {
        console.log("🎯 createItemCards() gestartet");
        console.log("📊 Anzahl Items:", data.items.length);
        console.log("📋 Items:", data.items);
        
        const itemsGrid = document.getElementById('itemsGrid');
        if (!itemsGrid) {
            console.error("❌ itemsGrid Element nicht gefunden!");
            return;
        }
        
        console.log("🧹 Leere itemsGrid...");
        itemsGrid.innerHTML = '';

        if (!data.items || data.items.length === 0) {
            console.error("❌ Keine Items vorhanden!");
            itemsGrid.innerHTML = '<div style="color: red; text-align: center; padding: 20px;">❌ Keine Beiträge gefunden! Bitte Browser-Konsole prüfen.</div>';
            return;
        }

        console.log("🔄 Erstelle Karten für", data.items.length, "Items...");
        
        data.items.forEach((item, index) => {
            console.log(`📦 Erstelle Karte ${index + 1}:`, item.name);
            
            const itemCard = document.createElement('div');
            itemCard.classList.add('item-card');
            if (item.persons && item.persons.length > 0) {
                itemCard.classList.add('taken');
            }

            let personsListHtml = '';
            if (item.persons && Array.isArray(item.persons)) {
                personsListHtml = item.persons.map(person => `
                    <div class="person-entry">
                        <span class="person-name">${person}</span>
                        <button class="btn-small btn-unregister" onclick="unregisterPerson('${item.id}', '${person}', false)">X</button>
                    </div>
                `).join('');
            }

            itemCard.innerHTML = `
                <div class="item-name">${item.name}</div>
                ${item.persons && item.persons.length > 0 ? `<div class="item-counter">${item.persons.length} ${item.persons.length === 1 ? 'Person' : 'Personen'}</div>` : ''}
                <div class="persons-list">${personsListHtml}</div>
                <div class="item-controls">
                    <input type="text" class="name-input" id="input-${item.id}" placeholder="Dein Name"/>
                    <button class="btn btn-take" onclick="registerPerson('${item.id}', false)">Eintragen</button>
                </div>
            `;
            itemsGrid.appendChild(itemCard);

            const inputElement = itemCard.querySelector(`#input-${item.id}`);
            if (inputElement) {
                inputElement.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter') {
                        registerPerson(item.id, false);
                    }
                });
            }
        });
        
        console.log("✅ createItemCards() abgeschlossen! Karten erstellt:", data.items.length);
    }

    // Zusätzliche Item-Karten erstellen
    function createAdditionalItemCards() {
        const additionalItemsGrid = document.getElementById('additionalItemsGrid');
        additionalItemsGrid.innerHTML = '';

        data.additionalItems.forEach(item => {
            const itemCard = document.createElement('div');
            itemCard.classList.add('additional-item-card');

            let personsListHtml = item.persons.map(person => `
                <div class="person-entry">
                    <span class="person-name">${person}</span>
                    <button class="btn-small btn-unregister" onclick="unregisterPerson('${item.id}', '${person}', true)">X</button>
                </div>
            `).join('');

            itemCard.innerHTML = `
                <div class="additional-item-name">${item.name}</div>
                ${item.persons.length > 0 ? `<div class="item-counter">${item.persons.length} ${item.persons.length === 1 ? 'Person' : 'Personen'}</div>` : ''}
                <div class="persons-list">${personsListHtml}</div>
                <div class="item-controls">
                    <input type="text" class="name-input" id="input-${item.id}" placeholder="Dein Name"/>
                    <button class="btn btn-take" onclick="registerPerson('${item.id}', true)">Eintragen</button>
                </div>
            `;
            additionalItemsGrid.appendChild(itemCard);

            const inputElement = itemCard.querySelector(`#input-${item.id}`);
            if (inputElement) {
                inputElement.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter') {
                        registerPerson(item.id, true);
                    }
                });
            }
        });
    }

    // Person eintragen
    function registerPerson(itemId, isAdditional) {
        const inputElement = document.getElementById(`input-${itemId}`);
        const personName = inputElement.value.trim();

        if (personName) {
            let itemArray = isAdditional ? data.additionalItems : data.items;
            let item = itemArray.find(i => i.id === itemId);

            if (item) {
                const existingPerson = item.persons.find(p => p.toLowerCase() === personName.toLowerCase());
                if (existingPerson) {
                    alert('Dieser Name ist bereits eingetragen!');
                    return;
                }
                
                item.persons.push(personName);
                inputElement.value = '';
                saveData();
                if (isAdditional) {
                    createAdditionalItemCards();
                } else {
                    createItemCards();
                }
                showThankYouEffect("Eintrag erfolgreich!");
            }
        } else {
            alert('Bitte gib deinen Namen ein!');
        }
    }

    // Person austragen
    function unregisterPerson(itemId, personName, isAdditional) {
        let itemArray = isAdditional ? data.additionalItems : data.items;
        let itemToFind = itemArray.find(i => i.id === itemId);
        let itemName = itemToFind ? itemToFind.name : "Unbekannter Beitrag";

        if (confirm(`Möchtest du "${personName}" wirklich von "${itemName}" austragen?`)) {
            let item = itemArray.find(i => i.id === itemId);

            if (item) {
                item.persons = item.persons.filter(p => p !== personName);
                saveData();
                if (isAdditional) {
                    createAdditionalItemCards();
                } else {
                    createItemCards();
                }
                showGoodbyeEffect("Erfolgreich ausgetragen!");
            }
        }
    }

    // Neues Item hinzufügen
    function addNewItem() {
        const newItemInput = document.getElementById('newItemInput');
        const newItemName = newItemInput.value.trim();

        if (newItemName) {
            const newItemId = newItemName.toLowerCase().replace(/[^a-z0-9]/g, '-');
            const existingItem = data.items.find(item => item.id === newItemId) || data.additionalItems.find(item => item.id === newItemId);

            if (existingItem) {
                alert('Dieser Beitrag existiert bereits!');
                return;
            }

            data.additionalItems.push({
                id: newItemId,
                name: newItemName,
                persons: []
            });
            newItemInput.value = '';
            saveData();
            createAdditionalItemCards();
            showThankYouEffect("Beitrag hinzugefügt!");
        } else {
            alert('Bitte gib einen Namen für den neuen Beitrag ein!');
        }
    }

    // Admin-Bereich Logik
    function adminLogin() {
        const passwordInput = document.getElementById('adminPassword');
        if (passwordInput.value === ADMIN_PASSWORD) {
            document.getElementById('adminLogin').style.display = 'none';
            document.getElementById('adminControls').style.display = 'block';
            checkAdminStatus();
        } else {
            alert('Falsches Passwort!');
        }
        passwordInput.value = '';
    }

    function adminLogout() {
        document.getElementById('adminLogin').style.display = 'block';
        document.getElementById('adminControls').style.display = 'none';
        googleDriveConnected = false;
        updateDriveStatus();
    }

    function checkAdminStatus() {
        const adminPasswordElement = document.getElementById('adminPassword');
        if (document.getElementById('adminControls').style.display === 'block' || adminPasswordElement.value === ADMIN_PASSWORD) {
            document.getElementById('adminLogin').style.display = 'none';
            document.getElementById('adminControls').style.display = 'block';
            document.getElementById('exportSection').style.display = 'block';
            if (CLIENT_ID !== 'YOUR_CLIENT_ID' && API_KEY !== 'YOUR_API_KEY') {
                updateDriveStatus();
                document.getElementById('driveStatus').style.display = 'block';
            } else {
                document.getElementById('driveStatus').style.display = 'none';
            }
        } else {
            document.getElementById('adminLogin').style.display = 'block';
            document.getElementById('adminControls').style.display = 'none';
            document.getElementById('driveStatus').style.display = 'none';
            document.getElementById('exportSection').style.display = 'none';
        }
    }

    // Google Drive Integration
    function gapiLoaded() {
        gapi.load('client', initializeGapiClient);
    }

    function initializeGapiClient() {
        gapi.client.init({
            apiKey: API_KEY,
            discoveryDocs: DISCOVERY_DOCS,
        }).then(() => {
            gapiInited = true;
            maybeEnableButtons();
        });
    }

    function gisLoaded() {
        tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: CLIENT_ID,
            scope: SCOPES,
            callback: (tokenResponse) => {
                if (tokenResponse && tokenResponse.access_token) {
                    googleDriveConnected = true;
                    updateDriveStatus();
                    loadFromGoogleDrive();
                }
            },
        });
        gisInited = true;
        maybeEnableButtons();
    }

    function maybeEnableButtons() {
        if (gapiInited && gisInited) {
            // Buttons können hier aktiviert werden falls nötig
        }
    }

    function connectToGoogleDrive() {
        if (!googleDriveConnected) {
            tokenClient.callback = (resp) => {
                if (resp.error) {
                    throw (resp);
                }
                googleDriveConnected = true;
                updateDriveStatus();
                loadFromGoogleDrive();
            };

            if (gapi.client.getToken() === null) {
                tokenClient.requestAccessToken({prompt: 'consent'});
            } else {
                tokenClient.requestAccessToken({prompt: ''});
            }
        }
    }

    function updateDriveStatus() {
        const driveStatusDiv = document.getElementById('driveStatus');
        const statusTextSpan = document.getElementById('statusText');
        const connectBtn = document.getElementById('connectBtn');

        if (googleDriveConnected) {
            driveStatusDiv.classList.remove('disconnected');
            driveStatusDiv.classList.add('connected');
            statusTextSpan.textContent = 'Verbunden';
            connectBtn.style.display = 'none';
        } else {
            driveStatusDiv.classList.remove('connected');
            driveStatusDiv.classList.add('disconnected');
            statusTextSpan.textContent = 'Nicht verbunden';
            connectBtn.style.display = 'block';
        }
    }

    // Google Drive file handling
    const FILE_NAME = 'party_data.json';
    const EXCEL_FILE_NAME = 'party_beitraege.xlsx';
    let fileId = null;

    async function loadFromGoogleDrive() {
        try {
            const response = await gapi.client.drive.files.list({
                spaces: 'appDataFolder',
                q: `name = '${FILE_NAME}'`
            });
            const files = response.result.files;
            if (files.length > 0) {
                fileId = files[0].id;
                const fileContentResponse = await gapi.client.drive.files.get({
                    fileId: fileId,
                    alt: 'media'
                });
                const loadedData = JSON.parse(fileContentResponse.body);
                data.items = data.items.map(defaultItem => {
                    const loadedItem = loadedData.items.find(item => item.id === defaultItem.id);
                    return loadedItem ? { ...defaultItem, ...loadedItem } : defaultItem;
                });
                loadedData.items.forEach(loadedItem => {
                    if (!data.items.some(defaultItem => defaultItem.id === loadedItem.id)) {
                        data.items.push(loadedItem);
                    }
                });
                data.additionalItems = loadedData.additionalItems || [];
                console.log('Data loaded from Google Drive:', data);
                createItemCards();
                createAdditionalItemCards();
            } else {
                console.log('No data file found on Google Drive, creating a new one.');
                saveToGoogleDrive();
            }
        } catch (error) {
            console.error('Error loading from Google Drive:', error);
            alert('Fehler beim Laden der Daten von Google Drive. Überprüfen Sie Ihre Verbindung und Berechtigungen.');
        }
    }

    async function saveToGoogleDrive() {
        const fileMetadata = {
            'name': FILE_NAME,
            'parents': ['appDataFolder']
        };
        const media = {
            mimeType: 'application/json',
            body: JSON.stringify(data)
        };

        try {
            if (fileId) {
                await gapi.client.drive.files.update({
                    fileId: fileId,
                    resource: fileMetadata,
                    media: media,
                    fields: 'id'
                });
                console.log('Data updated on Google Drive.');
            } else {
                const response = await gapi.client.drive.files.create({
                    resource: fileMetadata,
                    media: media,
                    fields: 'id'
                });
                fileId = response.result.id;
                console.log('Data saved to Google Drive, file ID:', fileId);
            }
        } catch (error) {
            console.error('Error saving to Google Drive:', error);
            alert('Fehler beim Speichern der Daten auf Google Drive. Überprüfen Sie Ihre Verbindung und Berechtigungen.');
        }
    }

    // Export Functions
    function exportToCSV() {
        let csvContent = "data:text/csv;charset=utf-8,";
        csvContent += "Kategorie,Beitrag,Name,Anzahl_Eingetragen\n";

        data.items.forEach(item => {
            if (item.persons.length > 0) {
                item.persons.forEach(person => {
                    csvContent += `Benötigt,"${item.name}","${person}",${item.persons.length}\n`;
                });
            } else {
                csvContent += `Benötigt,"${item.name}",,0\n`;
            }
        });

        data.additionalItems.forEach(item => {
            if (item.persons.length > 0) {
                item.persons.forEach(person => {
                    csvContent += `Weitere Beiträge,"${item.name}","${person}",${item.persons.length}\n`;
                });
            } else {
                csvContent += `Weitere Beiträge,"${item.name}",,0\n`;
            }
        });

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "party_beitraege.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showThankYouEffect("CSV Export erfolgreich!");
    }

    function exportToExcel() {
        let csvContent = "data:application/vnd.ms-excel;charset=utf-8,";
        csvContent += "Kategorie\tBeitrag\tName\tAnzahl_Eingetragen\n";

        data.items.forEach(item => {
            if (item.persons.length > 0) {
                item.persons.forEach(person => {
                    csvContent += `Benötigt\t"${item.name}"\t"${person}"\t${item.persons.length}\n`;
                });
            } else {
                csvContent += `Benötigt\t"${item.name}"\t\t0\n`;
            }
        });

        data.additionalItems.forEach(item => {
            if (item.persons.length > 0) {
                item.persons.forEach(person => {
                    csvContent += `Weitere Beiträge\t"${item.name}"\t"${person}"\t${item.persons.length}\n`;
                });
            } else {
                csvContent += `Weitere Beiträge\t"${item.name}"\t\t0\n`;
            }
        });

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "party_beitraege.xls");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showThankYouEffect("Excel Export erfolgreich!");
    }

    // Neue Sync-Funktion für Google Drive
    async function syncWithGoogleDrive() {
        if (!googleDriveConnected) {
            alert('Bitte zuerst mit Google Drive verbinden!');
            return;
        }

        try {
            // Excel-Daten für Google Drive vorbereiten
            let excelData = "Kategorie\tBeitrag\tName\tAnzahl_Eingetragen\n";

            data.items.forEach(item => {
                if (item.persons.length > 0) {
                    item.persons.forEach(person => {
                        excelData += `Benötigt\t"${item.name}"\t"${person}"\t${item.persons.length}\n`;
                    });
                } else {
                    excelData += `Benötigt\t"${item.name}"\t\t0\n`;
                }
            });

            data.additionalItems.forEach(item => {
                if (item.persons.length > 0) {
                    item.persons.forEach(person => {
                        excelData += `Weitere Beiträge\t"${item.name}"\t"${person}"\t${item.persons.length}\n`;
                    });
                } else {
                    excelData += `Weitere Beiträge\t"${item.name}"\t\t0\n`;
                }
            });

            // Prüfen ob Excel-Datei bereits existiert
            const excelListResponse = await gapi.client.drive.files.list({
                q: `name = '${EXCEL_FILE_NAME}'`
            });

            const fileMetadata = {
                'name': EXCEL_FILE_NAME
            };
            const media = {
                mimeType: 'application/vnd.ms-excel',
                body: excelData
            };

            if (excelListResponse.result.files.length > 0) {
                // Update existing file
                await gapi.client.drive.files.update({
                    fileId: excelListResponse.result.files[0].id,
                    resource: fileMetadata,
                    media: media,
                    fields: 'id'
                });
                showThankYouEffect("Google Drive synchronisiert!");
            } else {
                // Create new file
                await gapi.client.drive.files.create({
                    resource: fileMetadata,
                    media: media,
                    fields: 'id'
                });
                showThankYouEffect("Excel auf Google Drive erstellt!");
            }

            // Zusätzlich JSON-Daten speichern
            await saveToGoogleDrive();

        } catch (error) {
            console.error('Error syncing with Google Drive:', error);
            alert('Fehler bei der Synchronisation mit Google Drive!');
        }
    }

    function showShareLink() {
        if (!googleDriveConnected) {
            alert('Bitte zuerst mit Google Drive verbinden!');
            return;
        }
        
        const currentUrl = window.location.href;
        
        // Erstelle einen temporären Textbereich für die Zwischenablage
        const textArea = document.createElement('textarea');
        textArea.value = currentUrl;
        document.body.appendChild(textArea);
        textArea.select();
        
        try {
            document.execCommand('copy');
            showThankYouEffect("Link in Zwischenablage kopiert!");
        } catch (err) {
            alert(`Link zum Teilen: ${currentUrl}`);
        }
        
        document.body.removeChild(textArea);
    }

    // Sterne erzeugen
    function createStars() {
        const starsContainer = document.querySelector('.stars');
        for (let i = 0; i < 100; i++) {
            const star = document.createElement('div');
            star.classList.add('star');
            star.style.top = `${Math.random() * 100}%`;
            star.style.left = `${Math.random() * 100}%`;
            star.style.animationDelay = `${Math.random() * 2}s`;
            starsContainer.appendChild(star);
        }
    }

    // Neon-Linien erzeugen
    function createNeonLines() {
        const neonLinesContainer = document.querySelector('.neon-lines');
        for (let i = 0; i < 5; i++) {
            const line = document.createElement('div');
            line.classList.add('neon-line');
            line.style.top = `${Math.random() * 100}%`;
            line.style.animationDelay = `${Math.random() * 2}s`;
            line.style.animationDuration = `${3 + Math.random() * 2}s`;
            neonLinesContainer.appendChild(line);
        }
    }

    // Initialisierung - ROBUSTE VERSION MIT DEBUGGING
    document.addEventListener('DOMContentLoaded', async function() {
        console.log("🚀 =================================");
        console.log("🚀 APP INITIALISIERUNG GESTARTET");
        console.log("🚀 =================================");
        
        try {
            // Prüfe ob grundlegende Elemente vorhanden sind
            const itemsGrid = document.getElementById('itemsGrid');
            if (!itemsGrid) {
                console.error("❌ KRITISCHER FEHLER: itemsGrid Element nicht gefunden!");
                alert("FEHLER: HTML-Element 'itemsGrid' nicht gefunden! Bitte Seite neu laden.");
                return;
            }
            console.log("✅ itemsGrid Element gefunden");
            
            // Firebase Status anzeigen
            console.log("📡 Setze Firebase-Status...");
            updateFirebaseStatus();
            
            // UI-Grundlagen erstellen
            console.log("⭐ Erstelle Sterne und Neon-Linien...");
            createStars();
            createNeonLines();
            
            // WICHTIG: Standard-Items IMMER zuerst anzeigen
            console.log("📋 Zeige Standard-Items an...");
            console.log("🔍 Data vor createItemCards:", data);
            createItemCards();
            createAdditionalItemCards();
            
            // Fallback: Falls immer noch nichts da ist, manuelle Erstellung
            setTimeout(() => {
                const grid = document.getElementById('itemsGrid');
                if (grid && grid.children.length === 0) {
                    console.warn("⚠️ FALLBACK: Erstelle manuelle Item-Liste");
                    grid.innerHTML = `
                        <div style="color: yellow; padding: 20px; border: 2px solid #ffff00; border-radius: 10px; text-align: center;">
                            <h3>🔄 FALLBACK-MODUS</h3>
                            <p>Items werden manuell geladen...</p>
                            <button onclick="forceReload()" style="padding: 10px 20px; margin-top: 10px; border: none; border-radius: 5px; background: #ff00ff; color: white; cursor: pointer;">🔄 Neu laden</button>
                        </div>
                    `;
                }
            }, 2000);
            
            // Dann versuche Daten zu laden
            console.log("💾 Versuche Daten zu laden...");
            await loadData();
            
            // UI nach dem Laden aktualisieren
            console.log("🔄 Aktualisiere UI nach Datenladung...");
            createItemCards();
            createAdditionalItemCards();
            
            // Echtzeit-Listener einrichten (nur wenn Firebase verfügbar)
            if (isFirebaseConnected) {
                console.log("🔗 Richte Echtzeit-Listener ein...");
                setupRealtimeListener();
            }
            
            checkAdminStatus();
            
            // Event Listeners
            console.log("🎧 Richte Event-Listeners ein...");
            
            // Enter-Taste für neues Item
            const newItemInput = document.getElementById('newItemInput');
            if (newItemInput) {
                newItemInput.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter') {
                        addNewItem();
                    }
                });
            }
            
            // Enter-Taste für Admin-Login
            const adminPassword = document.getElementById('adminPassword');
            if (adminPassword) {
                adminPassword.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter') {
                        adminLogin();
                    }
                });
            }
            
            // Focus-Effekte für Admin-Input
            const adminInput = document.getElementById('adminPassword');
            const adminGlow = document.querySelector('.admin-input-glow');
            
            if (adminInput && adminGlow) {
                adminInput.addEventListener('focus', function() {
                    adminGlow.style.opacity = '1';
                });
                
                adminInput.addEventListener('blur', function() {
                    adminGlow.style.opacity = '0';
                });
            }

            // Initialize Google Drive nur wenn API keys vorhanden
            if (CLIENT_ID !== 'YOUR_CLIENT_ID' && API_KEY !== 'YOUR_API_KEY') {
                console.log("🌐 Initialisiere Google Drive...");
                const scriptGapi = document.createElement('script');
                scriptGapi.src = 'https://apis.google.com/js/api.js';
                scriptGapi.onload = gapiLoaded;
                document.head.appendChild(scriptGapi);

                const scriptGis = document.createElement('script');
                scriptGis.src = 'https://accounts.google.com/gsi/client';
                scriptGis.onload = gisLoaded;
                document.head.appendChild(scriptGis);
            }
            
            console.log("✅ ================================");
            console.log("✅ APP-INITIALISIERUNG ERFOLGREICH!");
            console.log("✅ ================================");
            
            // Debug-Info nach 3 Sekunden
            setTimeout(() => {
                debugData();
                console.log("🔍 Finale Überprüfung:");
                const finalGrid = document.getElementById('itemsGrid');
                console.log("📊 itemsGrid Kinder:", finalGrid ? finalGrid.children.length : "NICHT GEFUNDEN");
            }, 3000);
            
        } catch (error) {
            console.error("💥 KRITISCHER FEHLER bei Initialisierung:", error);
            alert("KRITISCHER FEHLER: " + error.message + "\n\nBitte Seite neu laden!");
        }
    });
    
    // Notfall-Reload Funktion
    window.forceReload = function() {
        console.log("🔄 FORCE RELOAD ausgeführt");
        createItemCards();
        createAdditionalItemCards();
    };
</script>

</body>
</html>
